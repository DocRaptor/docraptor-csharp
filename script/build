#!/bin/sh
set -e
cd "`dirname \"$0\"`/.."

MINIMAL_DOCRAPTOR_LIB="build/docraptor-minimal.dll"
EVERYTHING_DOCRAPTOR_LIB="build/docraptor-all.dll"

rm -rf build/
mkdir build

mcs -lib:bin -reference:Newtonsoft.Json.dll,RestSharp.dll,System.Runtime.Serialization.dll -target:library -out:$MINIMAL_DOCRAPTOR_LIB -recurse:src/*.cs

mono vendor/ILRepack.exe /internalize /out:$EVERYTHING_DOCRAPTOR_LIB $MINIMAL_DOCRAPTOR_LIB bin/*.dll

mono vendor/nuget.exe pack -OutputDirectory build/
